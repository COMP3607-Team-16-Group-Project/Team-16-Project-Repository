//-------------------------------
//COMP3607 Team 16 Group Project
//-------------------------------




//-------------------------------
//App Class:
//-------------------------------



//-------------------------------
//Maven Package Name:
//-------------------------------
package com.example;
//-------------------------------




//-------------------
//Import Statements:
//-------------------
import java.io.File;
import java.util.Map;
//-------------------



//--------------------------------------------------------------------------------------------------------------------------
//Class Body:
//--------------------------------------------------------------------------------------------------------------------------
public class App{
    //----------------------------------------------------------------------------------------------------------------------
    //Main Method:
    //----------------------------------------------------------------------------------------------------------------------
    public static void main(String[] args){
        try{
            //--------------------------------------------------------------------------------------------------------------
            // Set up input and output paths:
            //--------------------------------------------------------------------------------------------------------------
            File assignmentFile = new File("input\\Javonte_Baldeo_816036030_A1.zip");//Define directory for input file.
            File outputDirectory = new File("output");//Create directory for output of reports.
            //--------------------------------------------------------------------------------------------------------------




            //--------------------------------------------------------------------------------------------------------------
            //Make sure input zip file is present::
            //--------------------------------------------------------------------------------------------------------------
            if(!assignmentFile.exists()){
                System.out.println("Error: Submissions file not found. Exiting...");
                return;
            }
            //--------------------------------------------------------------------------------------------------------------




            //--------------------------------------------------------------------------------------------------------------
            //Make sure output directory was created properly:
            //--------------------------------------------------------------------------------------------------------------
            if(!outputDirectory.exists() && !outputDirectory.mkdirs()){
                System.out.println("Error: Could not create output directory. Exiting...");
                return;
            }
            //--------------------------------------------------------------------------------------------------------------




            //--------------------------------------------------------------------------------------------------------------
            //Extract the student ID from the file name:
            //--------------------------------------------------------------------------------------------------------------
            String fileName = assignmentFile.getName(); // Get the name of the ZIP file
            String studentID = fileName;
            //--------------------------------------------------------------------------------------------------------------




            //--------------------------------------------------------------------------------------------------------------
            //Make sure student ID exists:
            //--------------------------------------------------------------------------------------------------------------
            if (studentID == null){
                System.out.println("Error: Could not extract student ID from file name. Exiting...");
                return;
            }
            //--------------------------------------------------------------------------------------------------------------




            //--------------------------------------------------------------------------------------------------------------
            //Step 1: Process the ZIP file to extract Java files:
            //--------------------------------------------------------------------------------------------------------------
            SubmissionProcessor subProcessor = new SubmissionProcessor();
            subProcessor.processSubmission(assignmentFile);
            System.out.println("Submissions processed successfully.");
            //--------------------------------------------------------------------------------------------------------------




            //--------------------------------------------------------------------------------------------------------------
            // Step 2: Evaluate extracted Java files:
            //--------------------------------------------------------------------------------------------------------------
            JavaFileEvaluator evaluator = new JavaFileEvaluator(subProcessor.getJavaFiles());
            evaluator.evaluate();
            //--------------------------------------------------------------------------------------------------------------




            //--------------------------------------------------------------------------------------------------------------
            // Step 3: Retrieve evaluation results:
            //--------------------------------------------------------------------------------------------------------------
            Map<File, Map<String, Integer>> detailedResults = evaluator.getDetailedResults();
            //--------------------------------------------------------------------------------------------------------------




            //--------------------------------------------------------------------------------------------------------------
            // Step 4: Generate a PDF report:
            //--------------------------------------------------------------------------------------------------------------
            PDFReportGenerator reportGenerator = new PDFReportGenerator();
            reportGenerator.generateReport(detailedResults, studentID, outputDirectory);
            System.out.println("Evaluation report generated successfully at: " + outputDirectory.getAbsolutePath());
            //--------------------------------------------------------------------------------------------------------------




        }
        //------------------------------------------------------------------------------------------------------------------
        //Check for failures in the process:
        //------------------------------------------------------------------------------------------------------------------
        catch (Exception e){
            System.err.println("An error occurred while processing submissions:");
            e.printStackTrace();
        }
    }
    //----------------------------------------------------------------------------------------------------------------------
}
//--------------------------------------------------------------------------------------------------------------------------
